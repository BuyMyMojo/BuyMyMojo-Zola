<!DOCTYPE html>
<html lang="en">

<head>
    <title>BuyMyMojo</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://wip.buymymojo.net/style.css">
    <link rel="stylesheet" href="https://wip.buymymojo.net/color/pink.css">

        <link rel="stylesheet" href="https://wip.buymymojo.net/color/background_dark.css">
    
    <link rel="stylesheet" href="https://wip.buymymojo.net/font-hack-subset.css">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@OwenQuinlan7">
    <meta name="twitter:title" content="BuyMyMojo's place of nerdity">

    <meta name="twitter:description" content="Where else would you go to get nerdy ass content like this!">

    <meta name="twitter:image" content="https:&#x2F;&#x2F;wip.buymymojo.net/img/og-image.png">
    <!-- Load mastodon embed -->
    <script type="module" src="https://esm.sh/v99/emfed@1.0.0/es2022/emfed.js"></script>
    <link rel="stylesheet" type="text/css"
      href="https://cdn.jsdelivr.net/gh/sampsyo/emfed@main/toots.css">
    </head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://wip.buymymojo.net" style="text-decoration: none;">
                    <div class="logo">
                      
                            BuyMyMojo
                        
                    </div>
                </a>
            </div>
        </div>

        
        
                <nav class="menu">
            <ul class="menu__inner">
                <li class="active"><a href="https://wip.buymymojo.net">blog</a></li>
            
                <li><a href="https://wip.buymymojo.net/tags">tags</a></li>
            
                <li><a href="https://wip.buymymojo.net/posts">all posts</a></li>
            
                <li><a href="https://wip.buymymojo.net/find-me">find me</a></li>
            
                <li><a href="https://wip.buymymojo.net/about">about me</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    <center><sub>If Venom told you about this site she's full of shit~</sub></center>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://wip.buymymojo.net/making-an-api-in-go/">Making an API in Go</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2021-12-13
        </span>

    </div>

    
        <span class="post-tags-inline">
                :: tags:&nbsp;
                <a class="post-tag" href="https://wip.buymymojo.net/tags/learning/">#learning</a>&nbsp;
                <a class="post-tag" href="https://wip.buymymojo.net/tags/open-source/">#open-source</a>&nbsp;
                <a class="post-tag" href="https://wip.buymymojo.net/tags/golang/">#golang</a></span>
    

        
        <div class="post-content">
            <h2 id="update-2022-11-29">Update! 2022-11-29</h2>
<p>I am now a lot more into rust than go so I haven't explored this topic any further.
Making an API in rust is actually pretty sweet and I might revisit this topic in rust.</p>
<h1 class="post-title"></h1>
<sub>
Fun thing: to get this line seperating I had to write it as:
<pre data-lang="html" style="background-color:#2b303b;color:#c0c5ce;" class="language-html "><code class="language-html" data-lang="html"><span>&lt;</span><span style="color:#bf616a;">h1 </span><span style="color:#d08770;">class</span><span>=&quot;</span><span style="color:#a3be8c;">post-title</span><span>&quot;&gt;&lt;/</span><span style="color:#bf616a;">h1</span><span>&gt;&lt;/</span><span style="color:#bf616a;">code</span><span>&gt;
</span></code></pre>
</sub>
<h2 id="why-make-an-api">Why make an API?</h2>
<p>In my case it's to log the temp of my pool.
Me and my old man have been working on custom pool heating and we wanted to automate it a little.</p>
<p>I've been working on an arduino to measure the temp and to automatically shut off the heat pump when it is at X temp or it is X-PM in the arvo.</p>
<p>The arduino I'm using has an ESP 8266 wifi chip, so I'm gonna use that to access the API.</p>
<h2 id="how">How?</h2>
<p>I made the API in go so it could be light wight and ultra performant!</p>
<p>It has two very simple functions;</p>
<h3 id="log-temp-to-a-csv">Log temp to a CSV</h3>
<p>By going to <code>http://localhost:8080/log/{temp}</code> it saves whatever is after <code>log/</code> as the temp along with the current time and date inside of a CSV file</p>
<h3 id="display-all-entries-inside-the-csv-as-a-html-table">Display all entries inside the CSV as a HTML table</h3>
<p>By going to <code>http://localhost:8080/list/</code> it simple displays all entries as a table for easy checking</p>

  <img src="/img/screencaps/Screenshot-20211213141012-363x268/Screenshot-20211213141012-363x268.webp" alt="List of all temps" class="center" style="border-radius: 8px; width: 50%;" />

<h2 id="tech">Tech</h2>
<p>It's actually extremely simple;</p>
<h3 id="log">/log/</h3>
<p>using the <a href="https://github.com/gorilla/mux">mux</a> http routing library I can easily get the temp variable just by listening to <code>/log/{temp}</code></p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span>    </span><span style="color:#65737e;">// create a new instance of a mux router
</span><span> </span><span style="color:#bf616a;">r </span><span>:= </span><span style="color:#bf616a;">mux</span><span>.</span><span style="color:#bf616a;">NewRouter</span><span>()
</span><span>
</span><span> </span><span style="color:#65737e;">// treat anything after /log/ as the temp variable and call handleTemp
</span><span> </span><span style="color:#bf616a;">r</span><span>.</span><span style="color:#bf616a;">HandleFunc</span><span>(&quot;</span><span style="color:#a3be8c;">/log/{temp}</span><span>&quot;, </span><span style="color:#bf616a;">handleTemp</span><span>)
</span></code></pre>
<p>the <code>handleTemp</code> function simply returns <code>200 OK</code> to the user and calls aother function</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span>    </span><span style="color:#b48ead;">func </span><span style="color:#8fa1b3;">handleTemp</span><span>(</span><span style="color:#bf616a;">w http</span><span>.</span><span style="color:#b48ead;">ResponseWriter</span><span>, </span><span style="color:#bf616a;">r </span><span>*</span><span style="color:#bf616a;">http</span><span>.</span><span style="color:#b48ead;">Request</span><span>) {
</span><span>     </span><span style="color:#65737e;">// read temp from request
</span><span>     </span><span style="color:#bf616a;">vars </span><span>:= </span><span style="color:#bf616a;">mux</span><span>.</span><span style="color:#bf616a;">Vars</span><span>(</span><span style="color:#bf616a;">r</span><span>)
</span><span>
</span><span>     </span><span style="color:#65737e;">// reply with 200 OK
</span><span>     </span><span style="color:#bf616a;">w</span><span>.</span><span style="color:#bf616a;">WriteHeader</span><span>(</span><span style="color:#bf616a;">http</span><span>.</span><span style="color:#bf616a;">StatusOK</span><span>)
</span><span>
</span><span>     </span><span style="color:#65737e;">// log temp
</span><span>     </span><span style="color:#bf616a;">logTemp</span><span>(</span><span style="color:#bf616a;">vars</span><span>[&quot;</span><span style="color:#a3be8c;">temp</span><span>&quot;])
</span><span>    }
</span></code></pre>
<p><code>logTemp</code> only does a couple of things, it generates the date and time and then creates an entry in the csv file</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span>    </span><span style="color:#65737e;">// Get current date and time
</span><span> </span><span style="color:#bf616a;">dt </span><span>:= </span><span style="color:#bf616a;">time</span><span>.</span><span style="color:#bf616a;">Now</span><span>()
</span><span>
</span><span>    </span><span style="color:#65737e;">// Create new record
</span><span> </span><span style="color:#bf616a;">csvTitles </span><span>:= []</span><span style="color:#b48ead;">string</span><span>{</span><span style="color:#bf616a;">dt</span><span>.</span><span style="color:#bf616a;">Format</span><span>(&quot;</span><span style="color:#a3be8c;">01-02-2006 15:04:05</span><span>&quot;), </span><span style="color:#bf616a;">temp</span><span>}
</span><span>
</span><span> </span><span style="color:#65737e;">// Append record to CSV
</span><span> </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">err </span><span>:= </span><span style="color:#bf616a;">w</span><span>.</span><span style="color:#bf616a;">Write</span><span>(</span><span style="color:#bf616a;">csvTitles</span><span>); </span><span style="color:#bf616a;">err </span><span>!= </span><span style="color:#d08770;">nil </span><span>{
</span><span>  </span><span style="color:#bf616a;">log</span><span>.</span><span style="color:#bf616a;">Fatalln</span><span>(&quot;</span><span style="color:#a3be8c;">error writing record to file</span><span>&quot;, </span><span style="color:#bf616a;">err</span><span>)
</span><span> }
</span></code></pre>
<h3 id="list">/list/</h3>
<p>When you go to <code>/list/</code> it just lists through the CSV and quickly generates some basic HTML</p>
<pre data-lang="go" style="background-color:#2b303b;color:#c0c5ce;" class="language-go "><code class="language-go" data-lang="go"><span>    </span><span style="color:#bf616a;">htmlResponse </span><span>:= &quot;</span><span style="color:#a3be8c;">&lt;html&gt;&lt;head&gt;&lt;style&gt;table, th, td {</span><span style="color:#96b5b4;">\n</span><span style="color:#a3be8c;">  border: 1px solid black;</span><span style="color:#96b5b4;">\n</span><span style="color:#a3be8c;">}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;table&gt;&lt;tr&gt;&lt;th&gt;Date&lt;/th&gt;&lt;th&gt;Temperature&lt;/th&gt;&lt;/tr&gt;</span><span>&quot;
</span><span>
</span><span> </span><span style="color:#b48ead;">for </span><span style="color:#bf616a;">_</span><span>, </span><span style="color:#bf616a;">record </span><span>:= </span><span style="color:#b48ead;">range </span><span style="color:#bf616a;">records</span><span>[</span><span style="color:#d08770;">1</span><span>:] {
</span><span>  </span><span style="color:#bf616a;">htmlResponse </span><span>+= &quot;</span><span style="color:#a3be8c;">&lt;tr&gt;&lt;td&gt;</span><span>&quot; + </span><span style="color:#bf616a;">record</span><span>[</span><span style="color:#d08770;">0</span><span>] + &quot;</span><span style="color:#a3be8c;">&lt;/td&gt;&lt;td&gt;</span><span>&quot; + </span><span style="color:#bf616a;">record</span><span>[</span><span style="color:#d08770;">1</span><span>] + &quot;</span><span style="color:#a3be8c;">&lt;/td&gt;&lt;/tr&gt;</span><span>&quot;
</span><span> }
</span><span>
</span><span> </span><span style="color:#bf616a;">htmlResponse </span><span>+= &quot;</span><span style="color:#a3be8c;">&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;</span><span>&quot;
</span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>Writing a super basic API/Website in go is actually super easy! This was an enjoyable learning experince and went super smoothly.</p>
<p>I'm excited to learn more about Go APIs in the future!</p>

        </div>

        
        <div class="pagination">
            <div class="pagination__title">
                <span class="pagination__title-h">Thanks for reading! Read other posts?</span>
                <hr />
            </div>
            <div class="pagination__buttons">
                    <span class="button previous">
                        <a href="https://wip.buymymojo.net/learning-hugo/">
                            <span class="button__icon">←</span>&nbsp;
                            <span class="button__text">Learning HUGO</span>
                        </a>
                    </span>
                
                
                    <span class="button next">
                        <a href="https://wip.buymymojo.net/proton-and-linux/">
                            <span class="button__text">proton and linux gaming things [V1.0]</span>&nbsp;
                            <span class="button__icon">→</span>
                        </a>
                    </span>
                </div>
        </div>
    
    </div>

    </div>

    <a class="mastodon-feed" href="https://glitch.lgbt/@BuyMyMojo" data-toot-limit="4">follow me into the Fediverse</a>

    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright">
                        <span>© 
    2022
 BuyMyMojo</span>
                    <span class="copyright-theme">
                        <span class="copyright-theme-sep">:: </span>
                        Theme: <a href="https://github.com/pawroman/zola-theme-terminimal/">Terminimal</a> by pawroman
                    </span>
                </div>
            </div>
    </footer>
    

</div>
</body>

</html>
